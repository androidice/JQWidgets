<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en">
<head>
  <title>jqxTreeGrid</title>
  <link rel="stylesheet" href="../lib/jqwidgets/styles/jqx.base.css"
        type="text/css"/>
  <link rel="stylesheet" href="../lib/jqwidgets/styles/jqx.energyblue.css" t
        ype="text/css" />
  <script type="text/javascript" src="../lib/jquery-1.11.1.min.js"></script>
  <script type="text/javascript" src="../lib/jqwidgets/jqxcore.js"></script>
  <script type="text/javascript" src="../lib/jqwidgets/jqxdata.js"></script>
  <script type="text/javascript" src="../lib/jqwidgets/jqxbuttons.js"></script>
  <script type="text/javascript"
          src="../lib/jqwidgets/jqxscrollbar.js"></script>
  <script type="text/javascript" src="../lib/jqwidgets/jqxlistbox.js"></script>
  <script type="text/javascript"
          src="../lib/jqwidgets/jqxdropdownlist.js"></script>
  <script type="text/javascript" src="../lib/jqwidgets/jqxcheckbox.js"></script>
  <script type="text/javascript"
          src="../lib/jqwidgets/jqxdatatable.js"></script>
  <script type="text/javascript" src="../lib/jqwidgets/jqxtreegrid.js"></script>
  <script type="text/javascript" src="../lib/jqwidgets/jqxwindow.js"></script>
  <script type="text/javascript" src="../lib/jqwidgets/jqxmenu.js"></script>

  <script type="text/javascript">
    $(document).ready(function () {

      window.clearStorage = function(){
        localStorage.clear();
        sessionStorage.clear();
        console.log('storage has been cleared');
      };

      var data = [
        {
          "_id": 1,
          "parentId": 5,
          "campaign": "mollit voluptate ipsum",
          "isActive": true,
          "visits": 5169,
          "clicks": 10856,
          "ctr": 4893,
          "cvr": 12663,
          "epc": 15258,
          "revenue": 9259,
          "cost": 14841,
          "roi": 13184,
          "cpv": 18082,
          "epv": 2272,
          "cpa": 13466
        },
        {
          "_id": 2,
          "parentId": 5,
          "campaign": "do dolor velit",
          "isActive": true,
          "visits": 6671,
          "clicks": 8411,
          "ctr": 14593,
          "cvr": 17584,
          "epc": 10754,
          "revenue": 17300,
          "cost": 5285,
          "roi": 19142,
          "cpv": 15980,
          "epv": 16207,
          "cpa": 9118
        },
        {
          "_id": 3,
          "parentId": 5,
          "campaign": "laborum amet deserunt",
          "isActive": true,
          "visits": 2817,
          "clicks": 6364,
          "ctr": 1025,
          "cvr": 11725,
          "epc": 14569,
          "revenue": 18843,
          "cost": 15206,
          "roi": 12326,
          "cpv": 17172,
          "epv": 12621,
          "cpa": 6247
        },
        {
          "_id": 4,
          "parentId": null,
          "campaign": "consequat et ex",
          "isActive": true,
          "visits": 1748,
          "clicks": 4216,
          "ctr": 5015,
          "cvr": 6816,
          "epc": 5838,
          "revenue": 13093,
          "cost": 11760,
          "roi": 5933,
          "cpv": 5043,
          "epv": 12176,
          "cpa": 14259
        },
        {
          "_id": 5,
          "parentId": null,
          "campaign": "veniam proident pariatur",
          "isActive": true,
          "visits": 1925,
          "clicks": 18120,
          "ctr": 18767,
          "cvr": 5847,
          "epc": 2597,
          "revenue": 18733,
          "cost": 4636,
          "roi": 14721,
          "cpv": 19032,
          "epv": 10298,
          "cpa": 6899
        },
        {
          "_id": 6,
          "parentId": null,
          "campaign": "fugiat ipsum tempor",
          "isActive": false,
          "visits": 10579,
          "clicks": 14363,
          "ctr": 9230,
          "cvr": 5583,
          "epc": 2986,
          "revenue": 11530,
          "cost": 9303,
          "roi": 17433,
          "cpv": 10744,
          "epv": 5651,
          "cpa": 14451
        },
        {
          "_id": 7,
          "parentId": 6,
          "campaign": "do sint in",
          "isActive": false,
          "visits": 14036,
          "clicks": 18010,
          "ctr": 19878,
          "cvr": 11464,
          "epc": 2383,
          "revenue": 11899,
          "cost": 2847,
          "roi": 1938,
          "cpv": 6711,
          "epv": 17162,
          "cpa": 7867
        },
        {
          "_id": 8,
          "parentId": 6,
          "campaign": "et laborum ut",
          "isActive": true,
          "visits": 10120,
          "clicks": 2781,
          "ctr": 9726,
          "cvr": 9397,
          "epc": 2290,
          "revenue": 3207,
          "cost": 16180,
          "roi": 18137,
          "cpv": 6266,
          "epv": 5553,
          "cpa": 11997
        },
        {
          "_id": 9,
          "parentId": 6,
          "campaign": "eu cupidatat id",
          "isActive": true,
          "visits": 18686,
          "clicks": 12084,
          "ctr": 6042,
          "cvr": 1153,
          "epc": 9172,
          "revenue": 6621,
          "cost": 19847,
          "roi": 17519,
          "cpv": 16408,
          "epv": 10546,
          "cpa": 8480
        },
        {
          "_id": 10,
          "parentId": null,
          "campaign": "occaecat cillum voluptate",
          "isActive": true,
          "visits": 5602,
          "clicks": 17300,
          "ctr": 6389,
          "cvr": 11409,
          "epc": 12163,
          "revenue": 2845,
          "cost": 3508,
          "roi": 12824,
          "cpv": 11093,
          "epv": 11932,
          "cpa": 8040
        },
        {
          "_id": 11,
          "parentId": null,
          "campaign": "do proident labore",
          "isActive": true,
          "visits": 2433,
          "clicks": 16259,
          "ctr": 12874,
          "cvr": 17344,
          "epc": 19901,
          "revenue": 13686,
          "cost": 18725,
          "roi": 13130,
          "cpv": 10016,
          "epv": 18064,
          "cpa": 7909
        },
        {
          "_id": 12,
          "parentId": null,
          "campaign": "proident cillum voluptate",
          "isActive": true,
          "visits": 8116,
          "clicks": 10934,
          "ctr": 15913,
          "cvr": 10100,
          "epc": 14522,
          "revenue": 6271,
          "cost": 1863,
          "roi": 5600,
          "cpv": 15670,
          "epv": 4929,
          "cpa": 9669
        },
        {
          "_id": 13,
          "parentId": null,
          "campaign": "deserunt anim proident",
          "isActive": true,
          "visits": 3739,
          "clicks": 2081,
          "ctr": 12949,
          "cvr": 7061,
          "epc": 4376,
          "revenue": 14559,
          "cost": 16880,
          "roi": 6755,
          "cpv": 15501,
          "epv": 7784,
          "cpa": 15603
        },
        {
          "_id": 14,
          "parentId": null,
          "campaign": "velit aute do",
          "isActive": false,
          "visits": 18006,
          "clicks": 2493,
          "ctr": 7953,
          "cvr": 14114,
          "epc": 18513,
          "revenue": 3314,
          "cost": 3270,
          "roi": 2694,
          "cpv": 10804,
          "epv": 14666,
          "cpa": 4139
        },
        {
          "_id": 15,
          "parentId": null,
          "campaign": "quis adipisicing duis",
          "isActive": false,
          "visits": 14911,
          "clicks": 6845,
          "ctr": 1138,
          "cvr": 13616,
          "epc": 14807,
          "revenue": 5193,
          "cost": 9599,
          "roi": 16000,
          "cpv": 15258,
          "epv": 12763,
          "cpa": 13006
        },
        {
          "_id": 16,
          "parentId": null,
          "campaign": "exercitation deserunt aliquip",
          "isActive": true,
          "visits": 10573,
          "clicks": 19753,
          "ctr": 8906,
          "cvr": 5767,
          "epc": 13400,
          "revenue": 9234,
          "cost": 13170,
          "roi": 1887,
          "cpv": 11769,
          "epv": 9075,
          "cpa": 4885
        },
        {
          "_id": 17,
          "parentId": null,
          "campaign": "sunt laborum eu",
          "isActive": true,
          "visits": 2297,
          "clicks": 12892,
          "ctr": 1017,
          "cvr": 12187,
          "epc": 2477,
          "revenue": 4984,
          "cost": 4568,
          "roi": 6035,
          "cpv": 16418,
          "epv": 1224,
          "cpa": 18480
        },
        {
          "_id": 18,
          "parentId": null,
          "campaign": "do id velit",
          "isActive": true,
          "visits": 14291,
          "clicks": 12282,
          "ctr": 1843,
          "cvr": 6833,
          "epc": 7934,
          "revenue": 2192,
          "cost": 15256,
          "roi": 1771,
          "cpv": 3811,
          "epv": 18862,
          "cpa": 14968
        },
        {
          "_id": 19,
          "parentId": null,
          "campaign": "labore irure laborum",
          "isActive": true,
          "visits": 9488,
          "clicks": 7020,
          "ctr": 19748,
          "cvr": 12938,
          "epc": 8564,
          "revenue": 17013,
          "cost": 4501,
          "roi": 5604,
          "cpv": 6072,
          "epv": 5742,
          "cpa": 1180
        },
        {
          "_id": 20,
          "parentId": null,
          "campaign": "mollit anim ullamco",
          "isActive": true,
          "visits": 2350,
          "clicks": 6150,
          "ctr": 14470,
          "cvr": 3018,
          "epc": 12381,
          "revenue": 1595,
          "cost": 5614,
          "roi": 1239,
          "cpv": 8861,
          "epv": 8282,
          "cpa": 8899
        },
        {
          "_id": 21,
          "parentId": null,
          "campaign": "adipisicing pariatur cupidatat",
          "isActive": false,
          "visits": 4600,
          "clicks": 16718,
          "ctr": 16148,
          "cvr": 18921,
          "epc": 17455,
          "revenue": 13251,
          "cost": 1247,
          "roi": 3490,
          "cpv": 6926,
          "epv": 8840,
          "cpa": 7291
        },
        {
          "_id": 22,
          "parentId": null,
          "campaign": "officia minim officia",
          "isActive": true,
          "visits": 15933,
          "clicks": 18661,
          "ctr": 10616,
          "cvr": 17018,
          "epc": 3682,
          "revenue": 11512,
          "cost": 5784,
          "roi": 11763,
          "cpv": 10972,
          "epv": 3002,
          "cpa": 13676
        },
        {
          "_id": 23,
          "parentId": null,
          "campaign": "id enim duis",
          "isActive": true,
          "visits": 6474,
          "clicks": 17308,
          "ctr": 13720,
          "cvr": 7605,
          "epc": 2730,
          "revenue": 4693,
          "cost": 18016,
          "roi": 8512,
          "cpv": 15720,
          "epv": 19262,
          "cpa": 7829
        },
        {
          "_id": 24,
          "parentId": null,
          "campaign": "culpa quis nostrud",
          "isActive": true,
          "visits": 7667,
          "clicks": 18741,
          "ctr": 18857,
          "cvr": 3908,
          "epc": 16287,
          "revenue": 3028,
          "cost": 6154,
          "roi": 18955,
          "cpv": 14029,
          "epv": 16713,
          "cpa": 18692
        },
        {
          "_id": 25,
          "parentId": null,
          "campaign": "anim anim cupidatat",
          "isActive": false,
          "visits": 7827,
          "clicks": 6870,
          "ctr": 13690,
          "cvr": 5144,
          "epc": 3512,
          "revenue": 6594,
          "cost": 13738,
          "roi": 5726,
          "cpv": 14648,
          "epv": 19923,
          "cpa": 19561
        },
        {
          "_id": 26,
          "parentId": null,
          "campaign": "aliquip culpa pariatur",
          "isActive": true,
          "visits": 15711,
          "clicks": 5227,
          "ctr": 6013,
          "cvr": 4138,
          "epc": 16697,
          "revenue": 2468,
          "cost": 16807,
          "roi": 12770,
          "cpv": 13843,
          "epv": 6583,
          "cpa": 17730
        },
        {
          "_id": 27,
          "parentId": null,
          "campaign": "ullamco occaecat anim",
          "isActive": true,
          "visits": 18479,
          "clicks": 9947,
          "ctr": 1766,
          "cvr": 6097,
          "epc": 7135,
          "revenue": 7463,
          "cost": 18995,
          "roi": 18442,
          "cpv": 16255,
          "epv": 11994,
          "cpa": 9263
        },
        {
          "_id": 28,
          "parentId": null,
          "campaign": "exercitation ea aliqua",
          "isActive": false,
          "visits": 15326,
          "clicks": 5038,
          "ctr": 11332,
          "cvr": 5215,
          "epc": 12783,
          "revenue": 8637,
          "cost": 2931,
          "roi": 2465,
          "cpv": 10612,
          "epv": 3862,
          "cpa": 14629
        },
        {
          "_id": 29,
          "parentId": null,
          "campaign": "laborum esse enim",
          "isActive": false,
          "visits": 16802,
          "clicks": 5270,
          "ctr": 18417,
          "cvr": 7016,
          "epc": 13954,
          "revenue": 13065,
          "cost": 6591,
          "roi": 12552,
          "cpv": 16572,
          "epv": 10148,
          "cpa": 5238
        },
        {
          "_id": 30,
          "parentId": null,
          "campaign": "minim Lorem cupidatat",
          "isActive": false,
          "visits": 4949,
          "clicks": 16523,
          "ctr": 11328,
          "cvr": 7678,
          "epc": 6683,
          "revenue": 18604,
          "cost": 11862,
          "roi": 3726,
          "cpv": 11392,
          "epv": 19234,
          "cpa": 2095
        },
        {
          "_id": 31,
          "parentId": null,
          "campaign": "ut sit cillum",
          "isActive": false,
          "visits": 10553,
          "clicks": 6543,
          "ctr": 17482,
          "cvr": 8251,
          "epc": 10882,
          "revenue": 18947,
          "cost": 4753,
          "roi": 2012,
          "cpv": 5115,
          "epv": 11690,
          "cpa": 11459
        },
        {
          "_id": 32,
          "parentId": null,
          "campaign": "mollit Lorem aute",
          "isActive": false,
          "visits": 10009,
          "clicks": 2532,
          "ctr": 12200,
          "cvr": 4842,
          "epc": 10463,
          "revenue": 6589,
          "cost": 5353,
          "roi": 14914,
          "cpv": 17736,
          "epv": 16740,
          "cpa": 19155
        },
        {
          "_id": 33,
          "parentId": null,
          "campaign": "cillum velit veniam",
          "isActive": false,
          "visits": 12344,
          "clicks": 18160,
          "ctr": 15902,
          "cvr": 10997,
          "epc": 6752,
          "revenue": 4449,
          "cost": 14758,
          "roi": 15799,
          "cpv": 12311,
          "epv": 13432,
          "cpa": 9703
        }
      ];

      var stylizedCell = function (row, columnfield, value, dataObj, columnproperties){
        switch (columnfield){
          case 'roi':
            return `<span style="color: #14aa50">${value}</span>`;
          case 'isActive':
            if(value)
            {
              return '<span><img src="../images/green-circle.png" alt="" style="width:10px; height:10px"/></span>'
            }else{
              return '<span><img src="../images/red-circle.png" alt="" style="width:10px; height:10px"/></span>'
            }
          case 'campaign':
            if(dataObj.parentId==null){
              var template='';
              template = `<span>
                            ${value}
                            <div>
                              <button campaign-id=${dataObj._id}>Edit</button>
                              <button campaign-id=${dataObj._id}>Stats</button>
                              <button campaign-id=${dataObj._id}>Trash</button>
                            </div>
                        </span>`;
              return template;
            }else{
              return value;
            }

          default:
            return value;
        }
      };

      function buildGridSource() {
        var source =
              {
                dataType: "json",
                dataFields: [
                  { name: '_id', type: 'number' },
                  { name: 'parentId', type: 'number' },
                  { name: 'campaign', type: 'string' },
                  { name: 'isActive', type: 'boolean' },
                  { name: 'visits', type: 'number' },
                  { name: 'clicks', type: 'number' },
                  { name: 'ctr', type: 'number' },
                  { name: 'cvr', type: 'number' },
                  { name: 'epc', type: 'number' },
                  { name: 'revenue', type: 'number' },
                  { name: 'cost', type: 'number' },
                  { name: 'roi', type: 'number' },
                  { name: 'cpv', type: 'number' },
                  { name: 'epv', type: 'number' },
                  { name: 'cpa', type: 'number' },
                ],
                hierarchy: {
                  keyDataField: { name: '_id' },
                  parentDataField: { name: 'parentId' }
                },
                id: '_id',
                localData: data
              };

        return new $.jqx.dataAdapter(source);
      }

      function getGridSettings(){
        var gridSettings = {
          width: 1500,
          source: buildGridSource(),
          pageable: true,
          sortable: true,
          checkboxes: true,
          showToolbar: true,
          showStatusBar: true,
          pagerMode: 'advanced',
          theme: 'energyblue',
          ready: function () {
            // expand row with 'EmployeeKey = 2'
            $("#treeGrid").jqxTreeGrid('expandRow', 5);
            $("#treeGrid").jqxTreeGrid('expandRow', 6);
          },
          columns: [
            { text: 'ID', dataField: '_id', width: 200 },
            { text: 'Campaign', dataField: 'campaign', width: 200, cellsrenderer: stylizedCell },
            { text: '', dataField: 'isActive', width: 60 , cellsrenderer: stylizedCell },
            { text: 'Visits', dataField: 'visits', width: 120 },
            { text: 'Clicks', dataField: 'clicks', width: 120 },
            { text: 'CTR', dataField: 'ctr', width: 120 },
            { text: 'CVR', dataField: 'cvr', width: 120 },
            { text: 'EPC', dataField: 'epc', width: 120 },
            { text: 'Revenue', dataField: 'revenue', width: 120 },
            { text: 'Cost P/L', dataField: 'cost', width: 120 },
            { text: 'ROI', dataField: 'roi', width: 120, cellsrenderer: stylizedCell },
            { text: 'CPV', dataField: 'cpv', width: 120 },
            { text: 'EPV', dataField: 'epv', width: 120 },
            { text: 'CPA', dataField: 'cpa', width: 120 }
          ],
          renderToolbar: function (toolbar) {
            var container = $("<div style='margin: 5px;'></div>");
            var searchButton = $("<div style='float: left; margin-left: 5px;' ><img style='position: relative; margin-top: 2px;' src='../images/search.png'/><span style='margin-left: 4px; position: relative; top: -3px;'>Find</span></div>");
            container.append(searchButton);
            searchButton.jqxButton({  width: 50, height: 20 });
            toolbar.append(container);

            searchButton.click(function (event) {
              var offset = $("#treeGrid").offset();
              $("#jqxwindow").jqxWindow('open');
              $("#jqxwindow").jqxWindow('move', offset.left + 30, offset.top + 30);
            });
          },
          renderStatusBar: function(statusbar){
            function getVisits(){
              var visits = 0;
              var _data = data;
              _data.forEach(function(item){
                visits += item.visits;
              });
             return visits;
            }
            var container = $("<div style='margin: 5px;'></div>");
            container.append($("<div>Total</div>"));
            container.append($(`<div>visits: ${getVisits()}</div>`));
            statusbar.append(container);
          }
        };
        return gridSettings;
      }

      // create Tree Grid
      $("#treeGrid").jqxTreeGrid(getGridSettings());

      // create jqxWindow.
      $("#jqxwindow").jqxWindow({ resizable: false,  autoOpen: false, width: 210, height: 180 });
      // create find and clear buttons.
      $("#findButton").jqxButton({ width: 70});
      $("#clearButton").jqxButton({ width: 70});
      // create dropdownlist.
      $("#dropdownlist").jqxDropDownList({ autoDropDownHeight: true, selectedIndex: 0, width: 200, height: 23,
        source: [
          'Campaigns', 'Visits', 'ROI', 'Revenue', 'Cost P/L'
        ]
      });


      // create context menu
      var contextMenu = $("#Menu").jqxMenu({ width: 200, height: 110, autoOpenPopup: false, mode: 'popup' });
      $("#treeGrid").on('contextmenu', function () {
        return false;
      });

      $("#treeGrid").on('rowClick', function (event) {
        var args = event.args;
        if (args.originalEvent.button == 2) {
          var scrollTop = $(window).scrollTop();
          var scrollLeft = $(window).scrollLeft();
          contextMenu.jqxMenu('open', parseInt(event.args.originalEvent.clientX) + 5 + scrollLeft, parseInt(event.args.originalEvent.clientY) + 5 + scrollTop);

          return false;
        }
      });

      $("#Menu").on('itemclick', function (event) {
        var args = event.args;
        var selection = $("#treeGrid").jqxTreeGrid('getSelection');
        var rowid = selection[0].uid;
        switch ($.trim($(args).text())){
          case 'Stats Quickview':
            console.log('Stats Quickview');
            console.log('rowid', rowid);
            break;
          case 'Stats Drilldown':
            console.log('Stats Drilldown');
            console.log('rowid', rowid);
            break;
          default:
            console.log('others');
            console.log('rowid', rowid);
            return;
        }
      });

      /**
       * Events
       * */
      $("#treeGrid").on('rowCheck', function (event) {
        var rowData = args.row;
        console.log('checked data', rowData);
      });
      $("#treeGrid").on('rowUncheck', function (event) {
        var rowData = args.row;
        console.log('unchecked data', rowData);
      });

      // clear filters.
      $("#clearButton").click(function () {
        $("#treeGrid").jqxTreeGrid('clearFilters');
      });

      // find records that match a criteria.
      $("#findButton").click(function () {
        $("#treeGrid").jqxTreeGrid('clearFilters');
        var searchColumnIndex = $("#dropdownlist").jqxDropDownList('selectedIndex');
        var datafield = "";
        switch (searchColumnIndex) {
          case 0:
            datafield = "campaign";
            break;
          case 1:
            datafield = "visits";
            break;
          case 2:
            datafield = "roi";
            break;
          case 3:
            datafield = "revenue";
            break;
          case 4:
            datafield = "cost";
            break;
        }

        var searchText = $("#inputField").val();
        var filtergroup = new $.jqx.filter();
        var filter_or_operator = 1;
        var filtervalue = searchText;
        var filtercondition = 'contains';
        var filter = filtergroup.createfilter('stringfilter', filtervalue, filtercondition);
        filtergroup.addfilter(filter_or_operator, filter);
        $("#treeGrid").jqxTreeGrid('addFilter', datafield, filtergroup);
        // apply the filters.
        $("#treeGrid").jqxTreeGrid('applyFilters');
      });

    });
  </script>
</head>
<body class='default'>
<div id="jqxWidget">
  <div id="treeGrid">
  </div>
  <div id="jqxwindow">
    <div>
      Find Record</div>
    <div style="overflow: hidden;">
      <div>
        Find what:</div>
      <div style='margin-top:5px;'>
        <input id='inputField' type="text" class="jqx-input" style="width: 200px; height: 23px;" />
      </div>
      <div style="margin-top: 7px; clear: both;">
        Look in:</div>
      <div style='margin-top:5px;'>
        <div id='dropdownlist'>
        </div>
      </div>
      <div>
        <input type="button" style='margin-top: 15px; margin-left: 50px; float: left;' value="Find" id="findButton" />
        <input type="button" style='margin-left: 5px; margin-top: 15px; float: left;' value="Clear" id="clearButton" />
      </div>
    </div>
  </div>
  <div id='Menu'>
    <ul>
      <li>Stats Quickview</li>
      <li>Stats Drilldown</li>
      <li>Funnel Heatmap</li>
      <li>Reset Stats</li>
    </ul>
  </div>
</div>
</body>
</html>